# V20 ‚Äî –£–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏

## üéØ –¶–µ–ª–∏ V20

| –ú–µ—Ç—Ä–∏–∫–∞ | V19.3 | V20 –¶–µ–ª—å | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-------|----------|-----------|
| **Win Rate** | 50% | **60%** | +10% |
| **Return/episode** | -0.13% | **+0.3%** | +0.43% |
| **PnL/—Ç–æ—Ä–≥** | +0.05% | **+0.15%** | +0.10% |
| **–¢–æ—Ä–≥–æ–≤/—ç–ø–∏–∑–æ–¥** | 8 | **10-12** | +25-50% |

---

## üîß –£–ª—É—á—à–µ–Ω–∏—è Reward –§—É–Ω–∫—Ü–∏–∏

### 1. –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —à—Ç—Ä–∞—Ñ –∑–∞ —É–±—ã—Ç–∫–∏ ‚ùå

```python
# V19.3 ‚Üí V20:
loss_close_penalty_scale: 3.0 ‚Üí 10.0  (+233%)
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£–±—ã—Ç–æ–∫ -0.5%: reward -1.6 ‚Üí **-5.1** (–≤ 3.2x —Å–∏–ª—å–Ω–µ–µ)
- –ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è **–∏–∑–±–µ–≥–∞—Ç—å —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫**

---

### 2. Bonus –∑–∞ –ª—é–±—É—é –ø—Ä–∏–±—ã–ª—å–Ω—É—é —Å–¥–µ–ª–∫—É ‚úÖ

```python
# V20 NEW:
profitable_trade_bonus = 5.0

if pnl_pct > 0:
    reward += pnl_pct * 100
    reward += 5.0  # Fixed bonus for ANY profitable trade
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏–±—ã–ª—å +0.1%: reward = 0.1 + 5.0 = **5.1**
- –ú–æ–¥–µ–ª—å —Ü–µ–Ω–∏—Ç **–¥–∞–∂–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–∏–±—ã–ª–∏**

---

### 3. Progressive penalty –∑–∞ —Å–µ—Ä–∏—é —É–±—ã—Ç–∫–æ–≤ üìâ

```python
# V20 NEW:
consecutive_loss_penalty = 2.0

if consecutive_losses > 0:
    streak_penalty = consecutive_losses * 2.0
    reward -= streak_penalty
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- 1 —É–±—ã—Ç–æ–∫ –ø–æ–¥—Ä—è–¥: -2.0
- 2 —É–±—ã—Ç–∫–∞ –ø–æ–¥—Ä—è–¥: -4.0
- 3 —É–±—ã—Ç–∫–∞ –ø–æ–¥—Ä—è–¥: -6.0
- –ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è **—Å–Ω–∏–∂–∞—Ç—å —Ä–∏—Å–∫ –ø–æ—Å–ª–µ —É–±—ã—Ç–∫–æ–≤**

---

### 4. Bonus –∑–∞ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ ‚è∞

```python
# V20 NEW:
hold_profit_bonus_scale = 0.5

if unrealized_pnl_pct > 0:
    hold_profit_bonus = unrealized_pnl_pct * 100 * 0.5
    reward += hold_profit_bonus
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏–±—ã–ª—å +0.5% –≤ —Å–¥–µ–ª–∫–µ: +0.25 reward –∑–∞ —à–∞–≥
- –ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è **–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–æ–ª—å—à–µ**

---

### 5. –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —à—Ç—Ä–∞—Ñ –∑–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ üö™

```python
# V19.3 ‚Üí V20:
open_penalty: -0.1 ‚Üí -0.05  (-50%)
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ú–µ–Ω—å—à–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–æ–∫
- –ú–æ–¥–µ–ª—å –æ—Ö–æ—Ç–Ω–µ–µ —Ç–æ—Ä–≥—É–µ—Ç

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ Reward –°—Ü–µ–Ω–∞—Ä–∏–µ–≤

| –°—Ü–µ–Ω–∞—Ä–∏–π | V19.3 Reward | V20 Reward | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|----------|--------------|------------|-----------|
| **–ü—Ä–∏–±—ã–ª—å +0.5%** | +24.9 | **+35.0** | +40% ‚úÖ |
| **–ü—Ä–∏–±—ã–ª—å +0.1%** | +4.9 | **+10.0** | +104% ‚úÖ |
| **–£–±—ã—Ç–æ–∫ -0.5%** | -1.6 | **-5.1** | -219% ‚ùå |
| **–£–±—ã—Ç–æ–∫ -0.1%** | -0.4 | **-1.5** | -275% ‚ùå |
| **2 —É–±—ã—Ç–∫–∞ –ø–æ–¥—Ä—è–¥** | -3.2 | **-7.1** | -122% ‚ùå |
| **–î–µ—Ä–∂–∏–º +0.5% (10 —à–∞–≥–æ–≤)** | +0.2 | **+2.7** | +1250% ‚úÖ |

---

## üöÄ –ó–∞–ø—É—Å–∫ –û–±—É—á–µ–Ω–∏—è

### –ö–æ–º–∞–Ω–¥–∞:
```bash
cd /Volumes/Movies/PYTHON/RL-Algorithmic-Trading-Bot
source .venv/bin/activate
python train_v20_dqn.py
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **–®–∞–≥–æ–≤:** 1,000,000
- **–í—Ä–µ–º—è:** ~50-60 –º–∏–Ω—É—Ç
- **–ß–µ–∫–ø–æ–π–Ω—Ç—ã:** –∫–∞–∂–¥—ã–µ 100,000 —à–∞–≥–æ–≤

---

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –û–±—É—á–µ–Ω–∏—è

| –í—Ä–µ–º—è | –®–∞–≥–∏ | –û–∂–∏–¥–∞–µ–º—ã–π Loss | –û–∂–∏–¥–∞–µ–º—ã–π Reward |
|-------|------|----------------|------------------|
| 5 –º–∏–Ω | 100K | 0.01-0.05 | -0.05 ‚Äî 0.0 |
| 20 –º–∏–Ω | 300K | 0.005-0.02 | 0.0 ‚Äî 0.05 |
| 40 –º–∏–Ω | 700K | 0.001-0.01 | 0.05 ‚Äî 0.15 |
| 60 –º–∏–Ω | 1M | 0.0005-0.005 | **0.1 ‚Äî 0.3** ‚úÖ |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è:
```bash
# Paper trading (4 —ç–ø–∏–∑–æ–¥–∞)
python trade.py --paper --episodes 4

# –ò–ª–∏ —á–µ—Ä–µ–∑ eval —Å–∫—Ä–∏–ø—Ç
python eval_v20.py  # (—Å–æ–∑–¥–∞—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å eval_v19.py)
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –£—Å–ø–µ—Ö–∞

V20 —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–π –µ—Å–ª–∏:

- ‚úÖ **Win Rate > 55%** (V19.3: 50%)
- ‚úÖ **Return > +0.2%** (V19.3: -0.13%)
- ‚úÖ **PnL/—Ç–æ—Ä–≥ > +0.1%** (V19.3: +0.05%)
- ‚úÖ **–¢–æ—Ä–≥–æ–≤/—ç–ø–∏–∑–æ–¥: 10-12** (V19.3: 8)

---

## üìù Changelog

### V20.0 (2026-02-28)
- ‚úÖ `loss_close_penalty_scale`: 3.0 ‚Üí 10.0
- ‚úÖ `profit_close_bonus_scale`: 50.0 ‚Üí 60.0
- ‚úÖ `open_penalty`: -0.1 ‚Üí -0.05
- ‚úÖ `profitable_trade_bonus`: 5.0 (NEW)
- ‚úÖ `consecutive_loss_penalty`: 2.0 (NEW)
- ‚úÖ `hold_profit_bonus_scale`: 0.5 (NEW)
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ

---

**–°—Ç–∞—Ç—É—Å:** –û–±—É—á–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ ‚è≥
